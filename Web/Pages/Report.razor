@page "/report"

@inject NavigationManager NavManager
@inject Session session

@code {
    public NikeForm report { get; set; } = new NikeForm();
    public string dotColor { get; set; } = "redDot";

    protected override void OnInitialized()
    {
        if (!session.IsLoggedIn())
        {
            NavManager.NavigateTo($"/logout");
            return;
        }

        report = session._nikeForm;
        report.Sum();
    }
}

<div>
    <div class="mb-3">
        <h1>LPA</h1>
        <h2>Loss prevention awareness</h2>
    </div> @*Banner*@

    <div class="mb-3">
        <table class="table table-striped table-sm" style="font-size: 12px;">
            <tbody>
                <tr class="tableRow">
                    <th scope="row">Client</th>
                    <td>Nike</td>
                    <td rowspan="7">Scorecard 3</td>
                </tr>
                <tr class="tableRow">
                    <th scope="row">Store</th>
                    <td>?</td>
                </tr>
                <tr class="tableRow">
                    <th scope="row">Audit type</th>
                    <td>Nike</td>
                </tr>
                <tr class="tableRow">
                    <th scope="row">Date</th>
                    <td>@DateTime.Now.ToString()</td>
                </tr>
                <tr class="tableRow">
                    <th scope="row">Previous score</th>
                    <td>?</td>
                </tr>
                <tr class="tableRow">
                    <th scope="row">Current shrinkage</th>
                    <td>?</td>
                </tr>
                <tr class="tableRow">
                    <th scope="row">Address</th>
                    <td>?</td>
                </tr>
            </tbody>
        </table>
    </div> @*Heading*@

    <div class="mb-5">
        <p style="font-size:12px; border:1px solid; background-color:aliceblue">
            The objective of LPA is to assess adherence to procedures from the backdoor to the sales floor. 
            <br />There is no intent to find fault or blame with any staff member working at this store.
            <br />Consideration must also be given to the fact that the writer can only report on observations made on the day of the visit 
            <br />and we understand that this does not necessarily reflect the day to day operations at this store. 
            <br />In other words the 'as is state' may not be a true reflections of what actually occurs on a normal day.
        </p>
    </div> @*Disclaimer*@

    <div class="mb-5">
        <h4 class="text-center" style="background-color:aliceblue">Alerts</h4>
        <table class="table table-striped table-sm" style="font-size:12px;">
            <thead>
                <tr>
                    <th scope="col">Type</th>
                    <th scope="col">Response</th>
                    <th scope="col">Action</th>
                    <th scope="col">Responsible Person</th>
                    <th scope="col">Due Date</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var qSet in report.ListQSet)
                {
                    @foreach (var q in qSet.Questions.Where(s => s.Score < 0).ToList())
                    {
                        <tr class="tableRow">
                            <td><span class="redDot"></span></td>
                            <td>@q.Text</td>
                            <td>Fix</td>
                            <td>Me</td>
                            <td>@DateTime.Now.AddDays(7).ToString("dd-MM-yyyy")</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div> @*Alerts (Non - Compliance)*@

    @foreach (var qSet in report.ListQSet)
        {
        <div class="mb-5">
            <h4 class="text-center" style="background-color:aliceblue">LPA Store Analysis: @qSet.Title</h4>
            <table class="table table-striped table-sm" style="font-size:12px;">
                <thead>
                    <tr>
                        <th scope="col">Type</th>
                        <th scope="col">LPA Question</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var q in qSet.Questions)
                    {
                        if (q.Score > 0) { dotColor = "greenDot"; }
                        if (q.Score == 0) { dotColor = "blueDot"; }
                        if (q.Score < 0) { dotColor = "redDot"; }
                        <tr class="tableRow">
                            <td><span class="@dotColor"></span></td>
                            <td>@q.Text</td>
                        </tr>
                    }
                </tbody>
            </table>
            <h5 class="text-center" style="background-color:aliceblue">@qSet.Title LPA Score = @(qSet.ScorePercent)%</h5>
        </div> @*Question Sets*@
    }

    <div class="mb-5">
        <div class="row" style="border:1px solid">
            <div class="col-6" style="border-right:1px solid">
                <h4 class="mt-3" style="font-weight:bold">@session._user.NameSurname</h4>
                <p style="font-weight:bold">Date: @DateTime.Now.ToString("dddd, dd MMMM yyyy")</p>
            </div>
            <div class="col-6">
                <h3 class="text-center" style="background-color:aliceblue">Total LPA Score</h3>
                <table class="table table-striped table-sm" style="font-size: 12px;">
                    <thead>
                        <tr>
                            <th scope="col">Question</th>
                            <th scope="col">Percent</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var qSet in report.ListQSet)
                        {
                            <tr class="tableRow">
                                <td>@qSet.Title</td>
                                <td>@(qSet.ScorePercent)%</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div> @*Scores Summary*@
</div>

<style>
    .greenDot {
        height: 25px;
        width: 25px;
        background-color: green;
        border-radius: 50%;
        display: inline-block;
    }

    .blueDot {
        height: 25px;
        width: 25px;
        background-color: blue;
        border-radius: 50%;
        display: inline-block;
    }

    .redDot {
        height: 25px;
        width: 25px;
        background-color: red;
        border-radius: 50%;
        display: inline-block;
    }
</style>