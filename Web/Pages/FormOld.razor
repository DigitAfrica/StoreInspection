@page "/formOld"

@inject NavigationManager NavManager
@inject Session session

@code {
    public List<string> questions = new List<string>();
    public string msg = "";
    int defaultAnswer = -5;

    protected override void OnInitialized()
    {
        if (!session.IsLoggedIn())
        {
            NavManager.NavigateTo($"/logout");
            return;
        }
    }

    private void SetAnswer(ChangeEventArgs e, int question)
    {
        try
        {
            var q = session._nikeForm.QLodge.Questions[question - 1];
            var val = e!.Value!.ToString()!;

            var number = defaultAnswer;
            bool successParse = int.TryParse(val, out number);

            if (!successParse)
            {
                q.Score = defaultAnswer;
            }

            var value = int.Parse(val);

            q.Score = value;
        }
        catch
        {
            session._nikeForm.QLodge.Questions[question - 1].Score = defaultAnswer;
        }
    }

    private void Submit()
    {
        if (!session._nikeForm.QLodge.Validate())
        {
            msg = "please answer all questions";
            StateHasChanged();
            return;
        }

        NavManager.NavigateTo($"report");
    }
}

<div>
    <div class="row">
        <div class="col-1">

        </div>
        <div class="col-10">
            <div class="row">
                @foreach (var q in session._nikeForm.QLodge.Questions)
                {
                    <div class="col-6 mb-2">
                        @*<h6>@q.Text</h6>*@

                        @*@bind="q.Answer"*@

                        <select @onchange='(e => SetAnswer(e, q.Num))' class="form-control">
                            @foreach (var a in q.Answers)
                            {
                                <option value="@a.Value">@a.Name</option>
                            }
                        </select>

                        @if (q.Score == -1)
                        {
                            <p>Upload Image</p>
                            <p>Action</p>
                            <p>Date</p>
                        }
                        <p>@q.Score</p>
                    </div>
                }
            </div>
            
            <button @onclick=Submit>Submit</button>

            @if (!string.IsNullOrEmpty(msg))
            {
                <p style="color:red">@msg</p>
            }
        </div>
        <div class="col-1">
        </div>
    </div>
</div>